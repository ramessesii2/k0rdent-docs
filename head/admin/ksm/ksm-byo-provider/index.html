
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for k0rdent.">
      
      
        <meta name="author" content="Mirantis, Inc.">
      
      
      
        <link rel="prev" href="../ksm-built-in-provider/">
      
      
        <link rel="next" href="../ksm-service-templates/">
      
      
      <link rel="icon" href="../../../img/k0rdent-logo-mark-inverted.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>Build-Your-Own Provider - Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#build-your-own-ksm-provider" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Documentation" class="md-header__button md-logo" aria-label="Documentation" data-md-component="logo">
      
  <img src="../../../img/k0rdent-logo-horizontal-inverted.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Build-Your-Own Provider
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/k0rdent/kcm" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    k0rdent/kcm
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Documentation" class="md-nav__button md-logo" aria-label="Documentation" data-md-component="logo">
      
  <img src="../../../img/k0rdent-logo-horizontal-inverted.svg" alt="logo">

    </a>
    Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/k0rdent/kcm" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    k0rdent/kcm
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Welcome to the docs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../concepts/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    k0rdent concepts
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            k0rdent concepts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../concepts/why-k0rdent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Why k0rdent?
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../concepts/k0rdent-architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    k0rdent architecture
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../quickstarts/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    QuickStarts
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            QuickStarts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../quickstarts/quickstart-1-mgmt-node-and-cluster/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setup Management Cluster
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../quickstarts/quickstart-2-aws/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configure and Deploy to AWS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../quickstarts/quickstart-2-azure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configure and Deploy to Azure
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../quickstarts/quickstart-2-remote/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configure and Deploy w/ SSH
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../quickstarts/quickstart-2-gcp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configure and Deploy to GCP
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Administrator Guide
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Administrator Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../installation/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Installation
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Installation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../installation/create-mgmt-clusters/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Creating the management cluster
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_2_2" id="__nav_4_2_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_2">
            <span class="md-nav__icon md-icon"></span>
            Creating the management cluster
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/create-mgmt-clusters/mgmt-create-k0s-single/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Create a single node k0s cluster
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/create-mgmt-clusters/mgmt-create-k0s-multi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Create a multi-node k0s cluster
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/create-mgmt-clusters/mgmt-create-eks-multi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Create a multinode EKS cluster
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/install-k0rdent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install k0rdent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/verify-install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Verify the k0rdent installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../installation/prepare-mgmt-cluster/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Prepare k0rdent to create child clusters
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_2_5" id="__nav_4_2_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_5">
            <span class="md-nav__icon md-icon"></span>
            Prepare k0rdent to create child clusters
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/prepare-mgmt-cluster/aws/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/prepare-mgmt-cluster/azure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/prepare-mgmt-cluster/gcp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GCP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/prepare-mgmt-cluster/openstack/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenStack
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/prepare-mgmt-cluster/vmware/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VMware
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../installation/auth/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Authentication
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_2_6" id="__nav_4_2_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_6">
            <span class="md-nav__icon md-icon"></span>
            Authentication
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/auth/okta/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Okta
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/auth/entra-id/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Entra-ID
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../clusters/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Working with clusters
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Working with clusters
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../clusters/deploy-cluster/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deploying standalone clusters
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../clusters/update-cluster/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Updating standalone clusters
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../clusters/admin-adopting-clusters/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Adopting clusters
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../clusters/cluster-ipam/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IP Address Management (IPAM)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../clusters/migration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Migrate ClusterDeployment
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../regional-clusters/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Working with regional clusters
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            Working with regional clusters
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../regional-clusters/components-segregation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Regional Components Segregation Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../regional-clusters/regional-cluster-registration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Register Regional Cluster
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../regional-clusters/creating-credential-in-region/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Creating Credential in Region
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../regional-clusters/deploying-clusters-in-region/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deploying Clusters in Region
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Working with services
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            Working with services
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ksm-providers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    KSM Providers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ksm-built-in-provider/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Built-In Provider
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Build-Your-Own Provider
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Build-Your-Own Provider
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Architecture
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-1-deploy-your-cd-solution" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Deploy Your CD Solution
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-design-your-provider-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Design Your Provider Configuration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-implement-the-adapter-controller" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3: Implement the Adapter Controller
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 3: Implement the Adapter Controller">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#project-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Project Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#main-controller-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Main Controller Implementation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#main-entry-point" class="md-nav__link">
    <span class="md-ellipsis">
      Main Entry Point
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-build-and-deploy-the-adapter" class="md-nav__link">
    <span class="md-ellipsis">
      Step 4: Build and Deploy the Adapter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 4: Build and Deploy the Adapter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-dockerfile" class="md-nav__link">
    <span class="md-ellipsis">
      Create Dockerfile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-and-push-the-image" class="md-nav__link">
    <span class="md-ellipsis">
      Build and push the image
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-the-adapter" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy the adapter
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-5-create-statemanagementprovider" class="md-nav__link">
    <span class="md-ellipsis">
      Step 5: Create StateManagementProvider
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-6-test-your-provider" class="md-nav__link">
    <span class="md-ellipsis">
      Step 6: Test Your Provider
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 6: Test Your Provider">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-a-test-clusterdeployment" class="md-nav__link">
    <span class="md-ellipsis">
      Create a test ClusterDeployment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verify-the-provider-is-working" class="md-nav__link">
    <span class="md-ellipsis">
      Verify the provider is working
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Best Practices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      1. Error Handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-status-updates" class="md-nav__link">
    <span class="md-ellipsis">
      2. Status Updates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-label-management" class="md-nav__link">
    <span class="md-ellipsis">
      3. Label Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-owner-references" class="md-nav__link">
    <span class="md-ellipsis">
      4. Owner References
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-configuration-validation" class="md-nav__link">
    <span class="md-ellipsis">
      5. Configuration Validation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-topics" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Topics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Topics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#handling-multiple-clusters" class="md-nav__link">
    <span class="md-ellipsis">
      Handling Multiple Clusters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#priority-and-conflict-resolution" class="md-nav__link">
    <span class="md-ellipsis">
      Priority and Conflict Resolution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#health-checks" class="md-nav__link">
    <span class="md-ellipsis">
      Health Checks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ksm-service-templates/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Working with service templates
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ksm-multiclusterservice/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Creating multi-cluster services
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ksm-self-management/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deploying beach-head services on the Management Cluster itself
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../hosted-control-plane/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Hosted control planes
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6">
            <span class="md-nav__icon md-icon"></span>
            Hosted control planes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hosted-control-plane/hcp-aws/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hosted-control-plane/hcp-azure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hosted-control-plane/hcp-openstack/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenStack
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hosted-control-plane/hcp-vmware/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VMware
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hosted-control-plane/hcp-gcp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GCP
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../upgrade/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Upgrading k0rdent
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_7" id="__nav_4_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7">
            <span class="md-nav__icon md-icon"></span>
            Upgrading k0rdent
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../upgrade/upgrade-to-0-2-0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Upgrade to v0.2.0
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../upgrade/upgrade-to-0-3-0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Upgrade to v0.3.0
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../upgrade/upgrade-to-1-0-0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Upgrade to v1.0.0
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../upgrade/upgrade-to-1-1-1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Upgrade to v1.1.1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../upgrade/upgrade-to-1-2-0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Upgrade to v1.2.0
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../upgrade/upgrade-to-1-3-1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Upgrade to v1.3.1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../upgrade/upgrade-to-1-4-0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Upgrade to v1.4.0
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_8" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../access/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Access Management
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_8" id="__nav_4_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_8">
            <span class="md-nav__icon md-icon"></span>
            Access Management
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_8_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../access/credentials/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    k0rdent Credentials Management
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_8_2" id="__nav_4_8_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_8_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_8_2">
            <span class="md-nav__icon md-icon"></span>
            k0rdent Credentials Management
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access/credentials/credentials-process/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The Credentials Process
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access/credentials/credentials-propagation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Credential Propagation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access/credentials/cluster-identity-distribution/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cluster Identity Distribution
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_8_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../access/rbac/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    k0rdent Role Based Access Control (RBAC)
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_8_3" id="__nav_4_8_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_8_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_8_3">
            <span class="md-nav__icon md-icon"></span>
            k0rdent Role Based Access Control (RBAC)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access/rbac/what-roles-do/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    What Roles Do
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access/rbac/roles-summary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Role Definitions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access/rbac/limiting-access/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Limiting Access
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_9" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../backup/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Backup and Restore
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_9" id="__nav_4_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_9">
            <span class="md-nav__icon md-icon"></span>
            Backup and Restore
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../backup/prepare-backups/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Preparing for Backup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../backup/scheduled-backups/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scheduled Management Backups
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../backup/ondemand-backups/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Management Backup on Demand
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../backup/whats-included/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    What's Included in a Backup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../backup/restore/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Restoring From Backup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../backup/upgrades-rollbacks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Upgrades and Rollbacks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../backup/caveats/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Caveats
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../backup/customization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Customization
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../kof/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    k0rdent Observability & FinOps
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            k0rdent Observability & FinOps
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kof/kof-architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Architecture
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kof/kof-install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installing KOF
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kof/kof-kcm-region/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    KCM Region With KOF
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kof/kof-upgrade/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Upgrading KOF
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kof/kof-verification/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Verifying the KOF installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kof/kof-storing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Storing KOF data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kof/kof-using/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using KOF
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kof/kof-alerts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    KOF Alerts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kof/kof-scaling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scaling KOF
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kof/kof-maintainence/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Maintaining KOF
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kof/kof-resources/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Resource Requirements
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kof/kof-version-compat/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Version Compatibility
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../templatehowto/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Template How-To
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Template How-To
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../templatehowto/the-templating-system-common-threads/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The Templating System
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../templatehowto/modifying-clusterTemplates/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Creating and Modifying Templates
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../user/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    User Guide
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7" id="__nav_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user/user-create-cluster/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Creating clusters
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../user/services/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Adding services
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_3" id="__nav_7_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_3">
            <span class="md-nav__icon md-icon"></span>
            Adding services
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user/services/understanding-servicetemplates/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Understanding ServiceTemplates
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user/services/add-service-to-clusterdeployment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Adding a Service to a ClusterDeployment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user/services/beach-head/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Beach Head Services
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user/services/checking-status/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Checking Status
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user/services/remove-beach-head/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Remove Beach Head Services
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user/services/service-pause/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pause Beach Head Services Reconciliation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user/services/servicetemplate-parameters/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ServiceTemplate Parameters
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user/services/service-upgrade/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Upgrading Deployed Services
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../user/user-enable-drift-detection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Enabling drift detection
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
          
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../reference/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Reference
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_8" id="__nav_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../api-specification/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    API specification
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2">
            <span class="md-nav__icon md-icon"></span>
            API specification
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/crds/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    k0rdent CRDs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../reference/template/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    k0rdent Templates
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_8_4" id="__nav_8_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_4">
            <span class="md-nav__icon md-icon"></span>
            k0rdent Templates
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/template/template-predefined/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Removing predefined templates
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/template/template-byo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bring-your-own (BYO) templates
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/template/template-aws/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Templates for Amazon Web Services
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/template/template-azure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Templates for Azure
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/template/template-gcp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Templates for GCP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/template/template-openstack/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Templates for OpenStack
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/template/template-vsphere/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Templates for vSphere
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/template/template-remote/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Templates for Remote SSH
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../troubleshooting/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Troubleshooting
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_9" id="__nav_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Troubleshooting
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../troubleshooting/events/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Inspecting K0rdent Events
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../troubleshooting/admin-troubleshooting-aws-vpcs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS VPCs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../troubleshooting/known-issues-eks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EKS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../troubleshooting/known-issues-gcp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GCP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../troubleshooting/known-issues-custom-ca/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Custom CA Certificates
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../troubleshooting/known-issues-clusterctl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Clusterctl Issues
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../faq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Frequently Asked Questions
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../appendix/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Appendix
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_11" id="__nav_11_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            Appendix
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../appendix/glossary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Glossary
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../appendix/appendix-extend-mgmt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Extended management configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../appendix/private-secure-registry/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deploy from a private secure registry
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../appendix/appendix-dryrun/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Understanding the dry run
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../appendix/appendix-providers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cloud provider credentials management in CAPI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../appendix/arm64/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Running k0rdent on ARM64
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_8" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../appendix/telemetry/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Telemetry
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_11_8" id="__nav_11_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_11_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_8">
            <span class="md-nav__icon md-icon"></span>
            Telemetry
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../appendix/telemetry/data_collected/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Collected
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../appendix/telemetry/modes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Modes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../appendix/telemetry/configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuration
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../release-notes/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Release Notes
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_12" id="__nav_12_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            Release Notes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../release-notes/release-notes-v1.0.0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    v1.0.0
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../release-notes/release-notes-v1.1.0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    v1.1.0
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../release-notes/release-notes-v1.3.1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    v1.3.1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../release-notes/release-notes-v1.4.0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    v1.4.0
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../release-notes/release-notes-v1.5.0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    v1.5.0
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../contrib/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_13" id="__nav_13_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13">
            <span class="md-nav__icon md-icon"></span>
            Contributing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../contrib/k0rdent-documentation-contributors-guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    k0rdent documentation contributor's guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../contrib/k0rdent-documentation-style-guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    k0rdent documentation style guide
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Architecture
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-1-deploy-your-cd-solution" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Deploy Your CD Solution
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-design-your-provider-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Design Your Provider Configuration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-implement-the-adapter-controller" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3: Implement the Adapter Controller
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 3: Implement the Adapter Controller">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#project-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Project Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#main-controller-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Main Controller Implementation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#main-entry-point" class="md-nav__link">
    <span class="md-ellipsis">
      Main Entry Point
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-build-and-deploy-the-adapter" class="md-nav__link">
    <span class="md-ellipsis">
      Step 4: Build and Deploy the Adapter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 4: Build and Deploy the Adapter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-dockerfile" class="md-nav__link">
    <span class="md-ellipsis">
      Create Dockerfile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-and-push-the-image" class="md-nav__link">
    <span class="md-ellipsis">
      Build and push the image
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-the-adapter" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy the adapter
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-5-create-statemanagementprovider" class="md-nav__link">
    <span class="md-ellipsis">
      Step 5: Create StateManagementProvider
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-6-test-your-provider" class="md-nav__link">
    <span class="md-ellipsis">
      Step 6: Test Your Provider
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 6: Test Your Provider">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-a-test-clusterdeployment" class="md-nav__link">
    <span class="md-ellipsis">
      Create a test ClusterDeployment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verify-the-provider-is-working" class="md-nav__link">
    <span class="md-ellipsis">
      Verify the provider is working
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Best Practices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      1. Error Handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-status-updates" class="md-nav__link">
    <span class="md-ellipsis">
      2. Status Updates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-label-management" class="md-nav__link">
    <span class="md-ellipsis">
      3. Label Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-owner-references" class="md-nav__link">
    <span class="md-ellipsis">
      4. Owner References
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-configuration-validation" class="md-nav__link">
    <span class="md-ellipsis">
      5. Configuration Validation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-topics" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Topics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Topics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#handling-multiple-clusters" class="md-nav__link">
    <span class="md-ellipsis">
      Handling Multiple Clusters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#priority-and-conflict-resolution" class="md-nav__link">
    <span class="md-ellipsis">
      Priority and Conflict Resolution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#health-checks" class="md-nav__link">
    <span class="md-ellipsis">
      Health Checks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/k0rdent/docs/edit/main/docs/admin/ksm/ksm-byo-provider.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/k0rdent/docs/raw/main/docs/admin/ksm/ksm-byo-provider.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


<h1 id="build-your-own-ksm-provider">Build Your Own KSM Provider<a class="headerlink" href="#build-your-own-ksm-provider" title="Permanent link">#</a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>
Code examples provided below were not validated or compiled. They are provided to outline the idea
of how to develop custom provider for the CD tool you prefer and how to integrate it with k0rdent.</p>
</div>
<p>This guide walks you through creating a custom KSM (K0rdent Service Management) provider to reconcile k0rdent API resources. We'll use <strong>FluxCD</strong> as an example, but the same principles apply to any CD tool, such as ArgoCD, Rancher Fleet, or custom solutions.</p>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">#</a></h2>
<p>A KSM provider consists of three main components:</p>
<ol>
<li><strong>CD Solution</strong>: The underlying continuous delivery tool (e.g., FluxCD, ArgoCD)</li>
<li><strong>Adapter</strong>: A Kubernetes controller that watches <code>ServiceSet</code> objects and translates them to CD-tool-specific resources</li>
<li><strong>StateManagementProvider</strong>: A K0rdent resource that declares your provider and validates its readiness</li>
</ol>
<h2 id="architecture">Architecture<a class="headerlink" href="#architecture" title="Permanent link">#</a></h2>
<div class="highlight"><pre><span></span><code>
                     Management Cluster                 
                                                        
            
   ClusterDeployment        MultiClusterService     
                                                    
            
                                                      
                           
                                                       
                                                        
                                       
                   ServiceSet                   
                                      
                                       wartches &amp;     
                                        updates       
                                 
                Your Adapter                      
                Controller                            
                                  
                          creates                      
                                                       
                                  
                CD-Tool-Specific   (HelmRelease,      
                Resources          Kustomization,     
                   etc.)          
                                                       
                                                       
                           
             Your CD Tool Controllers                 
             (e.g., flux-system)                      
                           

                          
                            deploys to
                 
                  Target Cluster 
                 
</code></pre></div>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">#</a></h2>
<p>Before you begin, you should have:</p>
<ul>
<li>Go 1.24+ installed</li>
<li>Access to a Kubernetes cluster with K0rdent installed</li>
<li>Familiarity with Kubernetes controllers and controller-runtime</li>
<li>Understanding of your chosen CD tool's API</li>
</ul>
<h2 id="step-1-deploy-your-cd-solution">Step 1: Deploy Your CD Solution<a class="headerlink" href="#step-1-deploy-your-cd-solution" title="Permanent link">#</a></h2>
<p>First, deploy your CD solution to the management cluster. For FluxCD:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Install Flux</span>
flux<span class="w"> </span>install<span class="w"> </span>--namespace<span class="o">=</span>flux-system
</code></pre></div>
<p>Verify the installation:</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>deployments<span class="w"> </span>-n<span class="w"> </span>flux-system
</code></pre></div>
<p>Expected output:
<div class="highlight"><pre><span></span><code>NAME                       READY   UP-TO-DATE   AVAILABLE   AGE
helm-controller            1/1     1            1           1m
kustomize-controller       1/1     1            1           1m
notification-controller    1/1     1            1           1m
source-controller          1/1     1            1           1m
</code></pre></div></p>
<h2 id="step-2-design-your-provider-configuration">Step 2: Design Your Provider Configuration<a class="headerlink" href="#step-2-design-your-provider-configuration" title="Permanent link">#</a></h2>
<p>Define what configuration your provider needs. For FluxCD, we need:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// internal/provider/flux/config.go</span>
<span class="kn">package</span><span class="w"> </span><span class="nx">flux</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">kustomizev1</span><span class="w"> </span><span class="s">&quot;github.com/fluxcd/kustomize-controller/api/v1&quot;</span>
<span class="w">    </span><span class="nx">helmv2</span><span class="w"> </span><span class="s">&quot;github.com/fluxcd/helm-controller/api/v2&quot;</span>
<span class="p">)</span>

<span class="c1">// FluxProviderConfig defines configuration for the Flux provider</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">FluxProviderConfig</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Interval for reconciliation (e.g., &quot;5m&quot;, &quot;1h&quot;)</span>
<span class="w">    </span><span class="nx">Interval</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;interval,omitempty&quot;`</span>

<span class="w">    </span><span class="c1">// Prune enables garbage collection</span>
<span class="w">    </span><span class="nx">Prune</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="s">`json:&quot;prune,omitempty&quot;`</span>

<span class="w">    </span><span class="c1">// Wait enables health checks</span>
<span class="w">    </span><span class="nx">Wait</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="s">`json:&quot;wait,omitempty&quot;`</span>

<span class="w">    </span><span class="c1">// Timeout for operations</span>
<span class="w">    </span><span class="nx">Timeout</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;timeout,omitempty&quot;`</span>

<span class="w">    </span><span class="c1">// TargetNamespace for all resources</span>
<span class="w">    </span><span class="nx">TargetNamespace</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;targetNamespace,omitempty&quot;`</span>

<span class="w">    </span><span class="c1">// Suspend temporarily halts reconciliation</span>
<span class="w">    </span><span class="nx">Suspend</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="s">`json:&quot;suspend,omitempty&quot;`</span>

<span class="w">    </span><span class="c1">// Priority for handling conflicts (not native to Flux)</span>
<span class="w">    </span><span class="nx">Priority</span><span class="w"> </span><span class="kt">int32</span><span class="w"> </span><span class="s">`json:&quot;priority,omitempty&quot;`</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="step-3-implement-the-adapter-controller">Step 3: Implement the Adapter Controller<a class="headerlink" href="#step-3-implement-the-adapter-controller" title="Permanent link">#</a></h2>
<p>Create a controller that watches <code>ServiceSet</code> objects and creates Flux resources.</p>
<h3 id="project-structure">Project Structure<a class="headerlink" href="#project-structure" title="Permanent link">#</a></h3>
<div class="highlight"><pre><span></span><code>your-flux-adapter/
 cmd/
    manager/
        main.go
 internal/
    controller/
       serviceset_controller.go
       status_collector.go
       translator.go
    provider/
        flux/
            config.go
            types.go
 go.mod
 go.sum
</code></pre></div>
<h3 id="main-controller-implementation">Main Controller Implementation<a class="headerlink" href="#main-controller-implementation" title="Permanent link">#</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// internal/controller/serviceset_controller.go</span>
<span class="kn">package</span><span class="w"> </span><span class="nx">controller</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;context&quot;</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<span class="w">    </span><span class="s">&quot;time&quot;</span>

<span class="w">    </span><span class="nx">helmv2</span><span class="w"> </span><span class="s">&quot;github.com/fluxcd/helm-controller/api/v2&quot;</span>
<span class="w">    </span><span class="nx">kustomizev1</span><span class="w"> </span><span class="s">&quot;github.com/fluxcd/kustomize-controller/api/v1&quot;</span>
<span class="w">    </span><span class="nx">sourcev1</span><span class="w"> </span><span class="s">&quot;github.com/fluxcd/source-controller/api/v1&quot;</span>
<span class="w">    </span><span class="nx">corev1</span><span class="w"> </span><span class="s">&quot;k8s.io/api/core/v1&quot;</span>
<span class="w">    </span><span class="nx">apierrors</span><span class="w"> </span><span class="s">&quot;k8s.io/apimachinery/pkg/api/errors&quot;</span>
<span class="w">    </span><span class="nx">metav1</span><span class="w"> </span><span class="s">&quot;k8s.io/apimachinery/pkg/apis/meta/v1&quot;</span>
<span class="w">    </span><span class="s">&quot;k8s.io/apimachinery/pkg/util/json&quot;</span>
<span class="w">    </span><span class="nx">ctrl</span><span class="w"> </span><span class="s">&quot;sigs.k8s.io/controller-runtime&quot;</span>
<span class="w">    </span><span class="s">&quot;sigs.k8s.io/controller-runtime/pkg/client&quot;</span>
<span class="w">    </span><span class="s">&quot;sigs.k8s.io/controller-runtime/pkg/controller/controllerutil&quot;</span>

<span class="w">    </span><span class="nx">kcmv1</span><span class="w"> </span><span class="s">&quot;github.com/k0rdent/kcm/api/v1beta1&quot;</span>
<span class="w">    </span><span class="nx">fluxprovider</span><span class="w"> </span><span class="s">&quot;your-org/flux-adapter/internal/provider/flux&quot;</span>
<span class="p">)</span>

<span class="kd">const</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">ServiceSetFinalizer</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;flux.k0rdent.mirantis.com/serviceset&quot;</span>
<span class="w">    </span><span class="nx">AdapterLabel</span><span class="w">        </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;flux-adapter&quot;</span>
<span class="p">)</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">ServiceSetReconciler</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">client</span><span class="p">.</span><span class="nx">Client</span>
<span class="w">    </span><span class="nx">SystemNamespace</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">ServiceSetReconciler</span><span class="p">)</span><span class="w"> </span><span class="nx">Reconcile</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">req</span><span class="w"> </span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">Result</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">log</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">LoggerFrom</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Info</span><span class="p">(</span><span class="s">&quot;Reconciling ServiceSet&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Fetch the ServiceSet</span>
<span class="w">    </span><span class="nx">serviceSet</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">kcmv1</span><span class="p">.</span><span class="nx">ServiceSet</span><span class="p">{}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">NamespacedName</span><span class="p">,</span><span class="w"> </span><span class="nx">serviceSet</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">apierrors</span><span class="p">.</span><span class="nx">IsNotFound</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">Result</span><span class="p">{},</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">Result</span><span class="p">{},</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Handle deletion</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">serviceSet</span><span class="p">.</span><span class="nx">DeletionTimestamp</span><span class="p">.</span><span class="nx">IsZero</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">reconcileDelete</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">serviceSet</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Add finalizer</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">controllerutil</span><span class="p">.</span><span class="nx">ContainsFinalizer</span><span class="p">(</span><span class="nx">serviceSet</span><span class="p">,</span><span class="w"> </span><span class="nx">ServiceSetFinalizer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">controllerutil</span><span class="p">.</span><span class="nx">AddFinalizer</span><span class="p">(</span><span class="nx">serviceSet</span><span class="p">,</span><span class="w"> </span><span class="nx">ServiceSetFinalizer</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">Result</span><span class="p">{},</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Update</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">serviceSet</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Validate StateManagementProvider</span>
<span class="w">    </span><span class="nx">smp</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">kcmv1</span><span class="p">.</span><span class="nx">StateManagementProvider</span><span class="p">{}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">ObjectKey</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="nx">serviceSet</span><span class="p">.</span><span class="nx">Spec</span><span class="p">.</span><span class="nx">Provider</span><span class="p">.</span><span class="nx">Name</span><span class="p">},</span><span class="w"> </span><span class="nx">smp</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">Result</span><span class="p">{},</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to get StateManagementProvider: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Check if this ServiceSet matches our adapter</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">labelsMatchSelector</span><span class="p">(</span><span class="nx">serviceSet</span><span class="p">.</span><span class="nx">Labels</span><span class="p">,</span><span class="w"> </span><span class="nx">smp</span><span class="p">.</span><span class="nx">Spec</span><span class="p">.</span><span class="nx">Selector</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">V</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nx">Info</span><span class="p">(</span><span class="s">&quot;ServiceSet labels don&#39;t match provider selector, skipping&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">Result</span><span class="p">{},</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Update provider status in ServiceSet</span>
<span class="w">    </span><span class="nx">serviceSet</span><span class="p">.</span><span class="nx">Status</span><span class="p">.</span><span class="nx">Provider</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">kcmv1</span><span class="p">.</span><span class="nx">ProviderState</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Ready</span><span class="p">:</span><span class="w">     </span><span class="nx">smp</span><span class="p">.</span><span class="nx">Status</span><span class="p">.</span><span class="nx">Ready</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Suspended</span><span class="p">:</span><span class="w"> </span><span class="nx">smp</span><span class="p">.</span><span class="nx">Spec</span><span class="p">.</span><span class="nx">Suspend</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">smp</span><span class="p">.</span><span class="nx">Status</span><span class="p">.</span><span class="nx">Ready</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Info</span><span class="p">(</span><span class="s">&quot;StateManagementProvider not ready, skipping&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">Result</span><span class="p">{},</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Status</span><span class="p">().</span><span class="nx">Update</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">serviceSet</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">smp</span><span class="p">.</span><span class="nx">Spec</span><span class="p">.</span><span class="nx">Suspend</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Info</span><span class="p">(</span><span class="s">&quot;StateManagementProvider suspended, skipping&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">Result</span><span class="p">{},</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Status</span><span class="p">().</span><span class="nx">Update</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">serviceSet</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Parse provider configuration</span>
<span class="w">    </span><span class="nx">config</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">fluxprovider</span><span class="p">.</span><span class="nx">FluxProviderConfig</span><span class="p">{}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">serviceSet</span><span class="p">.</span><span class="nx">Spec</span><span class="p">.</span><span class="nx">Provider</span><span class="p">.</span><span class="nx">Config</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">Unmarshal</span><span class="p">(</span><span class="nx">serviceSet</span><span class="p">.</span><span class="nx">Spec</span><span class="p">.</span><span class="nx">Provider</span><span class="p">.</span><span class="nx">Config</span><span class="p">.</span><span class="nx">Raw</span><span class="p">,</span><span class="w"> </span><span class="nx">config</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">Result</span><span class="p">{},</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to parse provider config: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Create or update Flux resources for each service</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">reconcileServices</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">serviceSet</span><span class="p">,</span><span class="w"> </span><span class="nx">config</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">Result</span><span class="p">{},</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Collect status from Flux resources</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">collectServiceStatuses</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">serviceSet</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">Result</span><span class="p">{},</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Update ServiceSet status</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">Result</span><span class="p">{</span><span class="nx">RequeueAfter</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">},</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Status</span><span class="p">().</span><span class="nx">Update</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">serviceSet</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">ServiceSetReconciler</span><span class="p">)</span><span class="w"> </span><span class="nx">reconcileServices</span><span class="p">(</span>
<span class="w">    </span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span>
<span class="w">    </span><span class="nx">serviceSet</span><span class="w"> </span><span class="o">*</span><span class="nx">kcmv1</span><span class="p">.</span><span class="nx">ServiceSet</span><span class="p">,</span>
<span class="w">    </span><span class="nx">config</span><span class="w"> </span><span class="o">*</span><span class="nx">fluxprovider</span><span class="p">.</span><span class="nx">FluxProviderConfig</span><span class="p">,</span>
<span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">log</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">LoggerFrom</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">svc</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">serviceSet</span><span class="p">.</span><span class="nx">Spec</span><span class="p">.</span><span class="nx">Services</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Get the ServiceTemplate</span>
<span class="w">        </span><span class="nx">template</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">kcmv1</span><span class="p">.</span><span class="nx">ServiceTemplate</span><span class="p">{}</span>
<span class="w">        </span><span class="nx">key</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">ObjectKey</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="nx">svc</span><span class="p">.</span><span class="nx">Template</span><span class="p">,</span><span class="w"> </span><span class="nx">Namespace</span><span class="p">:</span><span class="w"> </span><span class="nx">serviceSet</span><span class="p">.</span><span class="nx">Namespace</span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">template</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to get ServiceTemplate %s: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Skip if template is not valid</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">template</span><span class="p">.</span><span class="nx">Status</span><span class="p">.</span><span class="nx">Valid</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">log</span><span class="p">.</span><span class="nx">Info</span><span class="p">(</span><span class="s">&quot;ServiceTemplate not valid, skipping&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;template&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">svc</span><span class="p">.</span><span class="nx">Template</span><span class="p">)</span>
<span class="w">            </span><span class="k">continue</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Create Flux resources based on template type</span>
<span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="nx">template</span><span class="p">.</span><span class="nx">Spec</span><span class="p">.</span><span class="nx">Helm</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="p">:</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">createHelmRelease</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">serviceSet</span><span class="p">,</span><span class="w"> </span><span class="nx">svc</span><span class="p">,</span><span class="w"> </span><span class="nx">template</span><span class="p">,</span><span class="w"> </span><span class="nx">config</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to create HelmRelease for %s: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">svc</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="nx">template</span><span class="p">.</span><span class="nx">Spec</span><span class="p">.</span><span class="nx">Kustomize</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="p">:</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">createKustomization</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">serviceSet</span><span class="p">,</span><span class="w"> </span><span class="nx">svc</span><span class="p">,</span><span class="w"> </span><span class="nx">template</span><span class="p">,</span><span class="w"> </span><span class="nx">config</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to create Kustomization for %s: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">svc</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="nx">template</span><span class="p">.</span><span class="nx">Spec</span><span class="p">.</span><span class="nx">Resources</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="p">:</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">createKustomization</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">serviceSet</span><span class="p">,</span><span class="w"> </span><span class="nx">svc</span><span class="p">,</span><span class="w"> </span><span class="nx">template</span><span class="p">,</span><span class="w"> </span><span class="nx">config</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to create Kustomization for resources %s: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">svc</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">ServiceSetReconciler</span><span class="p">)</span><span class="w"> </span><span class="nx">createHelmRelease</span><span class="p">(</span>
<span class="w">    </span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span>
<span class="w">    </span><span class="nx">serviceSet</span><span class="w"> </span><span class="o">*</span><span class="nx">kcmv1</span><span class="p">.</span><span class="nx">ServiceSet</span><span class="p">,</span>
<span class="w">    </span><span class="nx">svc</span><span class="w"> </span><span class="nx">kcmv1</span><span class="p">.</span><span class="nx">ServiceWithValues</span><span class="p">,</span>
<span class="w">    </span><span class="nx">template</span><span class="w"> </span><span class="o">*</span><span class="nx">kcmv1</span><span class="p">.</span><span class="nx">ServiceTemplate</span><span class="p">,</span>
<span class="w">    </span><span class="nx">config</span><span class="w"> </span><span class="o">*</span><span class="nx">fluxprovider</span><span class="p">.</span><span class="nx">FluxProviderConfig</span><span class="p">,</span>
<span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Build HelmRelease name</span>
<span class="w">    </span><span class="nx">name</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s-%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">serviceSet</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span><span class="w"> </span><span class="nx">svc</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
<span class="w">    </span><span class="nx">namespace</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">serviceSet</span><span class="p">.</span><span class="nx">Namespace</span>

<span class="w">    </span><span class="nx">helmRelease</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">helmv2</span><span class="p">.</span><span class="nx">HelmRelease</span><span class="p">{}</span>
<span class="w">    </span><span class="nx">helmRelease</span><span class="p">.</span><span class="nx">Name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">name</span>
<span class="w">    </span><span class="nx">helmRelease</span><span class="p">.</span><span class="nx">Namespace</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">namespace</span>

<span class="w">    </span><span class="c1">// Set owner reference</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">controllerutil</span><span class="p">.</span><span class="nx">SetControllerReference</span><span class="p">(</span><span class="nx">serviceSet</span><span class="p">,</span><span class="w"> </span><span class="nx">helmRelease</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Scheme</span><span class="p">());</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Create or update</span>
<span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">controllerutil</span><span class="p">.</span><span class="nx">CreateOrUpdate</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Client</span><span class="p">,</span><span class="w"> </span><span class="nx">helmRelease</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Set labels</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">helmRelease</span><span class="p">.</span><span class="nx">Labels</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">helmRelease</span><span class="p">.</span><span class="nx">Labels</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">helmRelease</span><span class="p">.</span><span class="nx">Labels</span><span class="p">[</span><span class="s">&quot;ksm.k0rdent.mirantis.com/managed&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;true&quot;</span>
<span class="w">        </span><span class="nx">helmRelease</span><span class="p">.</span><span class="nx">Labels</span><span class="p">[</span><span class="s">&quot;ksm.k0rdent.mirantis.com/serviceset&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">serviceSet</span><span class="p">.</span><span class="nx">Name</span>
<span class="w">        </span><span class="nx">helmRelease</span><span class="p">.</span><span class="nx">Labels</span><span class="p">[</span><span class="s">&quot;ksm.k0rdent.mirantis.com/service&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">svc</span><span class="p">.</span><span class="nx">Name</span>

<span class="w">        </span><span class="c1">// Configure HelmRelease spec</span>
<span class="w">        </span><span class="nx">helmRelease</span><span class="p">.</span><span class="nx">Spec</span><span class="p">.</span><span class="nx">ReleaseName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">svc</span><span class="p">.</span><span class="nx">Name</span>
<span class="w">        </span><span class="nx">helmRelease</span><span class="p">.</span><span class="nx">Spec</span><span class="p">.</span><span class="nx">TargetNamespace</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">svc</span><span class="p">.</span><span class="nx">Namespace</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">helmRelease</span><span class="p">.</span><span class="nx">Spec</span><span class="p">.</span><span class="nx">TargetNamespace</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">helmRelease</span><span class="p">.</span><span class="nx">Spec</span><span class="p">.</span><span class="nx">TargetNamespace</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">svc</span><span class="p">.</span><span class="nx">Name</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Set interval</span>
<span class="w">        </span><span class="nx">interval</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">metav1</span><span class="p">.</span><span class="nx">Duration</span><span class="p">{</span><span class="nx">Duration</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Minute</span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">Interval</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">d</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">ParseDuration</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">Interval</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">interval</span><span class="p">.</span><span class="nx">Duration</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">d</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">helmRelease</span><span class="p">.</span><span class="nx">Spec</span><span class="p">.</span><span class="nx">Interval</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">interval</span>

<span class="w">        </span><span class="c1">// Set timeout</span>
<span class="w">        </span><span class="nx">timeout</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">metav1</span><span class="p">.</span><span class="nx">Duration</span><span class="p">{</span><span class="nx">Duration</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Minute</span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">Timeout</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">d</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">ParseDuration</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">Timeout</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">timeout</span><span class="p">.</span><span class="nx">Duration</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">d</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">helmRelease</span><span class="p">.</span><span class="nx">Spec</span><span class="p">.</span><span class="nx">Timeout</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">timeout</span>

<span class="w">        </span><span class="c1">// Configure chart source from ServiceTemplate status</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">template</span><span class="p">.</span><span class="nx">Status</span><span class="p">.</span><span class="nx">SourceStatus</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">helmRelease</span><span class="p">.</span><span class="nx">Spec</span><span class="p">.</span><span class="nx">Chart</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">helmv2</span><span class="p">.</span><span class="nx">HelmChartTemplate</span><span class="p">{</span>
<span class="w">                </span><span class="nx">Spec</span><span class="p">:</span><span class="w"> </span><span class="nx">helmv2</span><span class="p">.</span><span class="nx">HelmChartTemplateSpec</span><span class="p">{</span>
<span class="w">                    </span><span class="nx">SourceRef</span><span class="p">:</span><span class="w"> </span><span class="nx">helmv2</span><span class="p">.</span><span class="nx">CrossNamespaceObjectReference</span><span class="p">{</span>
<span class="w">                        </span><span class="nx">Kind</span><span class="p">:</span><span class="w">      </span><span class="nx">template</span><span class="p">.</span><span class="nx">Status</span><span class="p">.</span><span class="nx">SourceStatus</span><span class="p">.</span><span class="nx">Kind</span><span class="p">,</span>
<span class="w">                        </span><span class="nx">Name</span><span class="p">:</span><span class="w">      </span><span class="nx">template</span><span class="p">.</span><span class="nx">Status</span><span class="p">.</span><span class="nx">SourceStatus</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span>
<span class="w">                        </span><span class="nx">Namespace</span><span class="p">:</span><span class="w"> </span><span class="nx">template</span><span class="p">.</span><span class="nx">Status</span><span class="p">.</span><span class="nx">SourceStatus</span><span class="p">.</span><span class="nx">Namespace</span><span class="p">,</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Set values</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">svc</span><span class="p">.</span><span class="nx">Values</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">helmRelease</span><span class="p">.</span><span class="nx">Spec</span><span class="p">.</span><span class="nx">Values</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">apiextensionsv1</span><span class="p">.</span><span class="nx">JSON</span><span class="p">{</span><span class="nx">Raw</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">svc</span><span class="p">.</span><span class="nx">Values</span><span class="p">)}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Apply provider configuration</span>
<span class="w">        </span><span class="nx">helmRelease</span><span class="p">.</span><span class="nx">Spec</span><span class="p">.</span><span class="nx">Suspend</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">Suspend</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">    </span><span class="p">})</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">ServiceSetReconciler</span><span class="p">)</span><span class="w"> </span><span class="nx">createKustomization</span><span class="p">(</span>
<span class="w">    </span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span>
<span class="w">    </span><span class="nx">serviceSet</span><span class="w"> </span><span class="o">*</span><span class="nx">kcmv1</span><span class="p">.</span><span class="nx">ServiceSet</span><span class="p">,</span>
<span class="w">    </span><span class="nx">svc</span><span class="w"> </span><span class="nx">kcmv1</span><span class="p">.</span><span class="nx">ServiceWithValues</span><span class="p">,</span>
<span class="w">    </span><span class="nx">template</span><span class="w"> </span><span class="o">*</span><span class="nx">kcmv1</span><span class="p">.</span><span class="nx">ServiceTemplate</span><span class="p">,</span>
<span class="w">    </span><span class="nx">config</span><span class="w"> </span><span class="o">*</span><span class="nx">fluxprovider</span><span class="p">.</span><span class="nx">FluxProviderConfig</span><span class="p">,</span>
<span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">name</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s-%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">serviceSet</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span><span class="w"> </span><span class="nx">svc</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
<span class="w">    </span><span class="nx">namespace</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">serviceSet</span><span class="p">.</span><span class="nx">Namespace</span>

<span class="w">    </span><span class="nx">kustomization</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">kustomizev1</span><span class="p">.</span><span class="nx">Kustomization</span><span class="p">{}</span>
<span class="w">    </span><span class="nx">kustomization</span><span class="p">.</span><span class="nx">Name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">name</span>
<span class="w">    </span><span class="nx">kustomization</span><span class="p">.</span><span class="nx">Namespace</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">namespace</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">controllerutil</span><span class="p">.</span><span class="nx">SetControllerReference</span><span class="p">(</span><span class="nx">serviceSet</span><span class="p">,</span><span class="w"> </span><span class="nx">kustomization</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Scheme</span><span class="p">());</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">controllerutil</span><span class="p">.</span><span class="nx">CreateOrUpdate</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Client</span><span class="p">,</span><span class="w"> </span><span class="nx">kustomization</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Set labels</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">kustomization</span><span class="p">.</span><span class="nx">Labels</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">kustomization</span><span class="p">.</span><span class="nx">Labels</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">kustomization</span><span class="p">.</span><span class="nx">Labels</span><span class="p">[</span><span class="s">&quot;ksm.k0rdent.mirantis.com/managed&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;true&quot;</span>
<span class="w">        </span><span class="nx">kustomization</span><span class="p">.</span><span class="nx">Labels</span><span class="p">[</span><span class="s">&quot;ksm.k0rdent.mirantis.com/serviceset&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">serviceSet</span><span class="p">.</span><span class="nx">Name</span>
<span class="w">        </span><span class="nx">kustomization</span><span class="p">.</span><span class="nx">Labels</span><span class="p">[</span><span class="s">&quot;ksm.k0rdent.mirantis.com/service&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">svc</span><span class="p">.</span><span class="nx">Name</span>

<span class="w">        </span><span class="c1">// Configure Kustomization spec</span>
<span class="w">        </span><span class="nx">interval</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">metav1</span><span class="p">.</span><span class="nx">Duration</span><span class="p">{</span><span class="nx">Duration</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Minute</span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">Interval</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">d</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">ParseDuration</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">Interval</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">interval</span><span class="p">.</span><span class="nx">Duration</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">d</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">kustomization</span><span class="p">.</span><span class="nx">Spec</span><span class="p">.</span><span class="nx">Interval</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">interval</span>

<span class="w">        </span><span class="c1">// Set source reference from ServiceTemplate</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">template</span><span class="p">.</span><span class="nx">Status</span><span class="p">.</span><span class="nx">SourceStatus</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">kustomization</span><span class="p">.</span><span class="nx">Spec</span><span class="p">.</span><span class="nx">SourceRef</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">kustomizev1</span><span class="p">.</span><span class="nx">CrossNamespaceSourceReference</span><span class="p">{</span>
<span class="w">                </span><span class="nx">Kind</span><span class="p">:</span><span class="w">      </span><span class="nx">template</span><span class="p">.</span><span class="nx">Status</span><span class="p">.</span><span class="nx">SourceStatus</span><span class="p">.</span><span class="nx">Kind</span><span class="p">,</span>
<span class="w">                </span><span class="nx">Name</span><span class="p">:</span><span class="w">      </span><span class="nx">template</span><span class="p">.</span><span class="nx">Status</span><span class="p">.</span><span class="nx">SourceStatus</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span>
<span class="w">                </span><span class="nx">Namespace</span><span class="p">:</span><span class="w"> </span><span class="nx">template</span><span class="p">.</span><span class="nx">Status</span><span class="p">.</span><span class="nx">SourceStatus</span><span class="p">.</span><span class="nx">Namespace</span><span class="p">,</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="c1">// Set path</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">template</span><span class="p">.</span><span class="nx">Spec</span><span class="p">.</span><span class="nx">Kustomize</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">kustomization</span><span class="p">.</span><span class="nx">Spec</span><span class="p">.</span><span class="nx">Path</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">template</span><span class="p">.</span><span class="nx">Spec</span><span class="p">.</span><span class="nx">Kustomize</span><span class="p">.</span><span class="nx">Path</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">template</span><span class="p">.</span><span class="nx">Spec</span><span class="p">.</span><span class="nx">Resources</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">kustomization</span><span class="p">.</span><span class="nx">Spec</span><span class="p">.</span><span class="nx">Path</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">template</span><span class="p">.</span><span class="nx">Spec</span><span class="p">.</span><span class="nx">Resources</span><span class="p">.</span><span class="nx">Path</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Set target namespace</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">svc</span><span class="p">.</span><span class="nx">Namespace</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">kustomization</span><span class="p">.</span><span class="nx">Spec</span><span class="p">.</span><span class="nx">TargetNamespace</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">svc</span><span class="p">.</span><span class="nx">Namespace</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Apply provider configuration</span>
<span class="w">        </span><span class="nx">kustomization</span><span class="p">.</span><span class="nx">Spec</span><span class="p">.</span><span class="nx">Prune</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">Prune</span>
<span class="w">        </span><span class="nx">kustomization</span><span class="p">.</span><span class="nx">Spec</span><span class="p">.</span><span class="nx">Wait</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">Wait</span>
<span class="w">        </span><span class="nx">kustomization</span><span class="p">.</span><span class="nx">Spec</span><span class="p">.</span><span class="nx">Suspend</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">Suspend</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">Timeout</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">d</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">ParseDuration</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">Timeout</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">kustomization</span><span class="p">.</span><span class="nx">Spec</span><span class="p">.</span><span class="nx">Timeout</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">metav1</span><span class="p">.</span><span class="nx">Duration</span><span class="p">{</span><span class="nx">Duration</span><span class="p">:</span><span class="w"> </span><span class="nx">d</span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">    </span><span class="p">})</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">ServiceSetReconciler</span><span class="p">)</span><span class="w"> </span><span class="nx">collectServiceStatuses</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">serviceSet</span><span class="w"> </span><span class="o">*</span><span class="nx">kcmv1</span><span class="p">.</span><span class="nx">ServiceSet</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">states</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="nx">kcmv1</span><span class="p">.</span><span class="nx">ServiceState</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">serviceSet</span><span class="p">.</span><span class="nx">Spec</span><span class="p">.</span><span class="nx">Services</span><span class="p">))</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">svc</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">serviceSet</span><span class="p">.</span><span class="nx">Spec</span><span class="p">.</span><span class="nx">Services</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">state</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">kcmv1</span><span class="p">.</span><span class="nx">ServiceState</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Name</span><span class="p">:</span><span class="w">                    </span><span class="nx">svc</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Namespace</span><span class="p">:</span><span class="w">               </span><span class="nx">svc</span><span class="p">.</span><span class="nx">Namespace</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Template</span><span class="p">:</span><span class="w">                </span><span class="nx">svc</span><span class="p">.</span><span class="nx">Template</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Version</span><span class="p">:</span><span class="w">                 </span><span class="nx">svc</span><span class="p">.</span><span class="nx">Template</span><span class="p">,</span>
<span class="w">            </span><span class="nx">State</span><span class="p">:</span><span class="w">                   </span><span class="nx">kcmv1</span><span class="p">.</span><span class="nx">ServiceStateProvisioning</span><span class="p">,</span>
<span class="w">            </span><span class="nx">LastStateTransitionTime</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">metav1</span><span class="p">.</span><span class="nx">Time</span><span class="p">{</span><span class="nx">Time</span><span class="p">:</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">()},</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Try to get HelmRelease</span>
<span class="w">        </span><span class="nx">helmName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s-%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">serviceSet</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span><span class="w"> </span><span class="nx">svc</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
<span class="w">        </span><span class="nx">helmRelease</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">helmv2</span><span class="p">.</span><span class="nx">HelmRelease</span><span class="p">{}</span>
<span class="w">        </span><span class="nx">helmErr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">ObjectKey</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="nx">helmName</span><span class="p">,</span><span class="w"> </span><span class="nx">Namespace</span><span class="p">:</span><span class="w"> </span><span class="nx">serviceSet</span><span class="p">.</span><span class="nx">Namespace</span><span class="p">},</span><span class="w"> </span><span class="nx">helmRelease</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">helmErr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">state</span><span class="p">.</span><span class="nx">Type</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">kcmv1</span><span class="p">.</span><span class="nx">ServiceTypeHelm</span>
<span class="w">            </span><span class="c1">// Check HelmRelease conditions</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">cond</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">helmRelease</span><span class="p">.</span><span class="nx">Status</span><span class="p">.</span><span class="nx">Conditions</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="nx">cond</span><span class="p">.</span><span class="nx">Type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Ready&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="nx">cond</span><span class="p">.</span><span class="nx">Status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">metav1</span><span class="p">.</span><span class="nx">ConditionTrue</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="nx">state</span><span class="p">.</span><span class="nx">State</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">kcmv1</span><span class="p">.</span><span class="nx">ServiceStateDeployed</span>
<span class="w">                    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">cond</span><span class="p">.</span><span class="nx">Reason</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;InstallFailed&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">cond</span><span class="p">.</span><span class="nx">Reason</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;UpgradeFailed&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="nx">state</span><span class="p">.</span><span class="nx">State</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">kcmv1</span><span class="p">.</span><span class="nx">ServiceStateFailed</span>
<span class="w">                        </span><span class="nx">state</span><span class="p">.</span><span class="nx">FailureMessage</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">cond</span><span class="p">.</span><span class="nx">Message</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                    </span><span class="k">break</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">apierrors</span><span class="p">.</span><span class="nx">IsNotFound</span><span class="p">(</span><span class="nx">helmErr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">helmErr</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Try to get Kustomization</span>
<span class="w">        </span><span class="nx">kustomName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s-%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">serviceSet</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span><span class="w"> </span><span class="nx">svc</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
<span class="w">        </span><span class="nx">kustomization</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">kustomizev1</span><span class="p">.</span><span class="nx">Kustomization</span><span class="p">{}</span>
<span class="w">        </span><span class="nx">kustomErr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">ObjectKey</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="nx">kustomName</span><span class="p">,</span><span class="w"> </span><span class="nx">Namespace</span><span class="p">:</span><span class="w"> </span><span class="nx">serviceSet</span><span class="p">.</span><span class="nx">Namespace</span><span class="p">},</span><span class="w"> </span><span class="nx">kustomization</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">kustomErr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">state</span><span class="p">.</span><span class="nx">Type</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">kcmv1</span><span class="p">.</span><span class="nx">ServiceTypeKustomize</span>
<span class="w">            </span><span class="c1">// Check Kustomization conditions</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">cond</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">kustomization</span><span class="p">.</span><span class="nx">Status</span><span class="p">.</span><span class="nx">Conditions</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="nx">cond</span><span class="p">.</span><span class="nx">Type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Ready&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="nx">cond</span><span class="p">.</span><span class="nx">Status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">metav1</span><span class="p">.</span><span class="nx">ConditionTrue</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="nx">state</span><span class="p">.</span><span class="nx">State</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">kcmv1</span><span class="p">.</span><span class="nx">ServiceStateDeployed</span>
<span class="w">                    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">cond</span><span class="p">.</span><span class="nx">Reason</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;ReconciliationFailed&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">cond</span><span class="p">.</span><span class="nx">Reason</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;BuildFailed&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="nx">state</span><span class="p">.</span><span class="nx">State</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">kcmv1</span><span class="p">.</span><span class="nx">ServiceStateFailed</span>
<span class="w">                        </span><span class="nx">state</span><span class="p">.</span><span class="nx">FailureMessage</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">cond</span><span class="p">.</span><span class="nx">Message</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                    </span><span class="k">break</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">apierrors</span><span class="p">.</span><span class="nx">IsNotFound</span><span class="p">(</span><span class="nx">kustomErr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">kustomErr</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nx">states</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">states</span><span class="p">,</span><span class="w"> </span><span class="nx">state</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">serviceSet</span><span class="p">.</span><span class="nx">Status</span><span class="p">.</span><span class="nx">Services</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">states</span>
<span class="w">    </span><span class="nx">serviceSet</span><span class="p">.</span><span class="nx">Status</span><span class="p">.</span><span class="nx">Deployed</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">state</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">states</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">State</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">kcmv1</span><span class="p">.</span><span class="nx">ServiceStateDeployed</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">serviceSet</span><span class="p">.</span><span class="nx">Status</span><span class="p">.</span><span class="nx">Deployed</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">false</span>
<span class="w">            </span><span class="k">break</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">ServiceSetReconciler</span><span class="p">)</span><span class="w"> </span><span class="nx">reconcileDelete</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">serviceSet</span><span class="w"> </span><span class="o">*</span><span class="nx">kcmv1</span><span class="p">.</span><span class="nx">ServiceSet</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">Result</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">log</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">LoggerFrom</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Info</span><span class="p">(</span><span class="s">&quot;Reconciling ServiceSet deletion&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Update service states to Deleting</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">serviceSet</span><span class="p">.</span><span class="nx">Status</span><span class="p">.</span><span class="nx">Services</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">serviceSet</span><span class="p">.</span><span class="nx">Status</span><span class="p">.</span><span class="nx">Services</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">State</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">kcmv1</span><span class="p">.</span><span class="nx">ServiceStateDeleting</span>
<span class="w">        </span><span class="nx">serviceSet</span><span class="p">.</span><span class="nx">Status</span><span class="p">.</span><span class="nx">Services</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">LastStateTransitionTime</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">metav1</span><span class="p">.</span><span class="nx">Time</span><span class="p">{</span><span class="nx">Time</span><span class="p">:</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">()}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Status</span><span class="p">().</span><span class="nx">Update</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">serviceSet</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">Result</span><span class="p">{},</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Remove finalizer (Flux resources will be deleted by owner reference)</span>
<span class="w">    </span><span class="nx">controllerutil</span><span class="p">.</span><span class="nx">RemoveFinalizer</span><span class="p">(</span><span class="nx">serviceSet</span><span class="p">,</span><span class="w"> </span><span class="nx">ServiceSetFinalizer</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">Result</span><span class="p">{},</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Update</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">serviceSet</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">ServiceSetReconciler</span><span class="p">)</span><span class="w"> </span><span class="nx">SetupWithManager</span><span class="p">(</span><span class="nx">mgr</span><span class="w"> </span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">Manager</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">NewControllerManagedBy</span><span class="p">(</span><span class="nx">mgr</span><span class="p">).</span>
<span class="w">        </span><span class="nx">For</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">kcmv1</span><span class="p">.</span><span class="nx">ServiceSet</span><span class="p">{}).</span>
<span class="w">        </span><span class="nx">Owns</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">helmv2</span><span class="p">.</span><span class="nx">HelmRelease</span><span class="p">{}).</span>
<span class="w">        </span><span class="nx">Owns</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">kustomizev1</span><span class="p">.</span><span class="nx">Kustomization</span><span class="p">{}).</span>
<span class="w">        </span><span class="nx">Complete</span><span class="p">(</span><span class="nx">r</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">labelsMatchSelector</span><span class="p">(</span><span class="nx">labels</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">selector</span><span class="w"> </span><span class="o">*</span><span class="nx">metav1</span><span class="p">.</span><span class="nx">LabelSelector</span><span class="p">)</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">selector</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">selector</span><span class="p">.</span><span class="nx">MatchLabels</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">labels</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="main-entry-point">Main Entry Point<a class="headerlink" href="#main-entry-point" title="Permanent link">#</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// cmd/manager/main.go</span>
<span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;flag&quot;</span>
<span class="w">    </span><span class="s">&quot;os&quot;</span>

<span class="w">    </span><span class="nx">helmv2</span><span class="w"> </span><span class="s">&quot;github.com/fluxcd/helm-controller/api/v2&quot;</span>
<span class="w">    </span><span class="nx">kustomizev1</span><span class="w"> </span><span class="s">&quot;github.com/fluxcd/kustomize-controller/api/v1&quot;</span>
<span class="w">    </span><span class="nx">sourcev1</span><span class="w"> </span><span class="s">&quot;github.com/fluxcd/source-controller/api/v1&quot;</span>
<span class="w">    </span><span class="s">&quot;k8s.io/apimachinery/pkg/runtime&quot;</span>
<span class="w">    </span><span class="nx">ctrl</span><span class="w"> </span><span class="s">&quot;sigs.k8s.io/controller-runtime&quot;</span>
<span class="w">    </span><span class="s">&quot;sigs.k8s.io/controller-runtime/pkg/log/zap&quot;</span>

<span class="w">    </span><span class="nx">kcmv1</span><span class="w"> </span><span class="s">&quot;github.com/k0rdent/kcm/api/v1beta1&quot;</span>
<span class="w">    </span><span class="s">&quot;your-org/flux-adapter/internal/controller&quot;</span>
<span class="p">)</span>

<span class="kd">var</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">scheme</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">runtime</span><span class="p">.</span><span class="nx">NewScheme</span><span class="p">()</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">kcmv1</span><span class="p">.</span><span class="nx">AddToScheme</span><span class="p">(</span><span class="nx">scheme</span><span class="p">)</span>
<span class="w">    </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">helmv2</span><span class="p">.</span><span class="nx">AddToScheme</span><span class="p">(</span><span class="nx">scheme</span><span class="p">)</span>
<span class="w">    </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">kustomizev1</span><span class="p">.</span><span class="nx">AddToScheme</span><span class="p">(</span><span class="nx">scheme</span><span class="p">)</span>
<span class="w">    </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">sourcev1</span><span class="p">.</span><span class="nx">AddToScheme</span><span class="p">(</span><span class="nx">scheme</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">metricsAddr</span><span class="w"> </span><span class="kt">string</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">enableLeaderElection</span><span class="w"> </span><span class="kt">bool</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">systemNamespace</span><span class="w"> </span><span class="kt">string</span>

<span class="w">    </span><span class="nx">flag</span><span class="p">.</span><span class="nx">StringVar</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">metricsAddr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;metrics-bind-address&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;:8080&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;The address the metric endpoint binds to.&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">flag</span><span class="p">.</span><span class="nx">BoolVar</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">enableLeaderElection</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;leader-elect&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Enable leader election for controller manager.&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">flag</span><span class="p">.</span><span class="nx">StringVar</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">systemNamespace</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;system-namespace&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;kcm-system&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;The namespace where KCM is installed.&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">flag</span><span class="p">.</span><span class="nx">Parse</span><span class="p">()</span>

<span class="w">    </span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">SetLogger</span><span class="p">(</span><span class="nx">zap</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="nx">zap</span><span class="p">.</span><span class="nx">UseDevMode</span><span class="p">(</span><span class="kc">true</span><span class="p">)))</span>

<span class="w">    </span><span class="nx">mgr</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">NewManager</span><span class="p">(</span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">GetConfigOrDie</span><span class="p">(),</span><span class="w"> </span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">Options</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Scheme</span><span class="p">:</span><span class="w">             </span><span class="nx">scheme</span><span class="p">,</span>
<span class="w">        </span><span class="nx">MetricsBindAddress</span><span class="p">:</span><span class="w"> </span><span class="nx">metricsAddr</span><span class="p">,</span>
<span class="w">        </span><span class="nx">LeaderElection</span><span class="p">:</span><span class="w">     </span><span class="nx">enableLeaderElection</span><span class="p">,</span>
<span class="w">        </span><span class="nx">LeaderElectionID</span><span class="p">:</span><span class="w">   </span><span class="s">&quot;flux-adapter.k0rdent.mirantis.com&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">Log</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;unable to start manager&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="nx">os</span><span class="p">.</span><span class="nx">Exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="nx">controller</span><span class="p">.</span><span class="nx">ServiceSetReconciler</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Client</span><span class="p">:</span><span class="w">          </span><span class="nx">mgr</span><span class="p">.</span><span class="nx">GetClient</span><span class="p">(),</span>
<span class="w">        </span><span class="nx">SystemNamespace</span><span class="p">:</span><span class="w"> </span><span class="nx">systemNamespace</span><span class="p">,</span>
<span class="w">    </span><span class="p">}).</span><span class="nx">SetupWithManager</span><span class="p">(</span><span class="nx">mgr</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">Log</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;unable to create controller&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;controller&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ServiceSet&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="nx">os</span><span class="p">.</span><span class="nx">Exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">Log</span><span class="p">.</span><span class="nx">Info</span><span class="p">(</span><span class="s">&quot;starting manager&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">mgr</span><span class="p">.</span><span class="nx">Start</span><span class="p">(</span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">SetupSignalHandler</span><span class="p">());</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">Log</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;problem running manager&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="nx">os</span><span class="p">.</span><span class="nx">Exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="step-4-build-and-deploy-the-adapter">Step 4: Build and Deploy the Adapter<a class="headerlink" href="#step-4-build-and-deploy-the-adapter" title="Permanent link">#</a></h2>
<h3 id="create-dockerfile">Create Dockerfile<a class="headerlink" href="#create-dockerfile" title="Permanent link">#</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">golang:1.24</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="s">builder</span>

<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/workspace</span>
<span class="k">COPY</span><span class="w"> </span>go.mod<span class="w"> </span>go.sum<span class="w"> </span>./
<span class="k">RUN</span><span class="w"> </span>go<span class="w"> </span>mod<span class="w"> </span>download

<span class="k">COPY</span><span class="w"> </span>.<span class="w"> </span>.
<span class="k">RUN</span><span class="w"> </span><span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="nv">GOOS</span><span class="o">=</span>linux<span class="w"> </span>go<span class="w"> </span>build<span class="w"> </span>-a<span class="w"> </span>-o<span class="w"> </span>manager<span class="w"> </span>cmd/manager/main.go

<span class="k">FROM</span><span class="w"> </span><span class="s">gcr.io/distroless/static:nonroot</span>
<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/</span>
<span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>builder<span class="w"> </span>/workspace/manager<span class="w"> </span>.
<span class="k">USER</span><span class="w"> </span><span class="s">65532:65532</span>

<span class="k">ENTRYPOINT</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;/manager&quot;</span><span class="p">]</span>
</code></pre></div>
<h3 id="build-and-push-the-image">Build and push the image<a class="headerlink" href="#build-and-push-the-image" title="Permanent link">#</a></h3>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>your-registry/flux-adapter:v0.1.0<span class="w"> </span>.
docker<span class="w"> </span>push<span class="w"> </span>your-registry/flux-adapter:v0.1.0
</code></pre></div>
<h3 id="deploy-the-adapter">Deploy the adapter<a class="headerlink" href="#deploy-the-adapter" title="Permanent link">#</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># deploy/deployment.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flux-adapter</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kcm-system</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flux-adapter</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flux-adapter</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">serviceAccountName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flux-adapter</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manager</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">your-registry/flux-adapter:v0.1.0</span>
<span class="w">        </span><span class="nt">args</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--leader-elect</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--system-namespace=kcm-system</span>
<span class="w">        </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">          </span><span class="nt">limits</span><span class="p">:</span>
<span class="w">            </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">500m</span>
<span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512Mi</span>
<span class="w">          </span><span class="nt">requests</span><span class="p">:</span>
<span class="w">            </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100m</span>
<span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">128Mi</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flux-adapter</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kcm-system</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flux-adapter</span>
<span class="nt">rules</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;k0rdent.mirantis.com&quot;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;servicesets&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;servicetemplates&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;statemanagementproviders&quot;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;get&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;list&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;watch&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;update&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;patch&quot;</span><span class="p p-Indicator">]</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;k0rdent.mirantis.com&quot;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;servicesets/status&quot;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;get&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;update&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;patch&quot;</span><span class="p p-Indicator">]</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;helm.toolkit.fluxcd.io&quot;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;helmreleases&quot;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;get&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;list&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;watch&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;create&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;update&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;patch&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;delete&quot;</span><span class="p p-Indicator">]</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;kustomize.toolkit.fluxcd.io&quot;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;kustomizations&quot;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;get&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;list&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;watch&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;create&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;update&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;patch&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;delete&quot;</span><span class="p p-Indicator">]</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;source.toolkit.fluxcd.io&quot;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;gitrepositories&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;helmrepositories&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;buckets&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;ocirepositories&quot;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;get&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;list&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;watch&quot;</span><span class="p p-Indicator">]</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRoleBinding</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flux-adapter</span>
<span class="nt">roleRef</span><span class="p">:</span>
<span class="w">  </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
<span class="w">  </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flux-adapter</span>
<span class="nt">subjects</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flux-adapter</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kcm-system</span>
</code></pre></div>
<p>Apply the deployment:</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>deploy/deployment.yaml
</code></pre></div>
<h2 id="step-5-create-statemanagementprovider">Step 5: Create StateManagementProvider<a class="headerlink" href="#step-5-create-statemanagementprovider" title="Permanent link">#</a></h2>
<p>Create a <code>StateManagementProvider</code> resource that registers your provider:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k0rdent.mirantis.com/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">StateManagementProvider</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ksm-flux</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">adapter</span><span class="p">:</span>
<span class="w">    </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flux-adapter</span>
<span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kcm-system</span>
<span class="w">    </span><span class="nt">readinessRule</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span>
<span class="w">      </span><span class="no">self.status.availableReplicas == self.status.replicas &amp;&amp;</span>
<span class="w">      </span><span class="no">self.status.availableReplicas == self.status.updatedReplicas &amp;&amp;</span>
<span class="w">      </span><span class="no">self.status.availableReplicas == self.status.readyReplicas</span>
<span class="w">  </span><span class="nt">provisioner</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">helm-controller</span>
<span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flux-system</span>
<span class="w">    </span><span class="nt">readinessRule</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span>
<span class="w">      </span><span class="no">self.status.availableReplicas &gt; 0 &amp;&amp;</span>
<span class="w">      </span><span class="no">self.status.readyReplicas &gt; 0</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kustomize-controller</span>
<span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flux-system</span>
<span class="w">    </span><span class="nt">readinessRule</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span>
<span class="w">      </span><span class="no">self.status.availableReplicas &gt; 0 &amp;&amp;</span>
<span class="w">      </span><span class="no">self.status.readyReplicas &gt; 0</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">source-controller</span>
<span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flux-system</span>
<span class="w">    </span><span class="nt">readinessRule</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span>
<span class="w">      </span><span class="no">self.status.availableReplicas &gt; 0 &amp;&amp;</span>
<span class="w">      </span><span class="no">self.status.readyReplicas &gt; 0</span>
<span class="w">  </span><span class="nt">provisionerCRDs</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">helm.toolkit.fluxcd.io</span>
<span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v2</span>
<span class="w">    </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">helmreleases</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kustomize.toolkit.fluxcd.io</span>
<span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="w">    </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kustomizations</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">source.toolkit.fluxcd.io</span>
<span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="w">    </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gitrepositories</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">helmrepositories</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ocirepositories</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">buckets</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">ksm.k0rdent.mirantis.com/adapter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flux-adapter</span>
<span class="w">  </span><span class="nt">suspend</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</code></pre></div>
<p>Apply it:</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>statemanagementprovider.yaml
</code></pre></div>
<h2 id="step-6-test-your-provider">Step 6: Test Your Provider<a class="headerlink" href="#step-6-test-your-provider" title="Permanent link">#</a></h2>
<h3 id="create-a-test-clusterdeployment">Create a test ClusterDeployment<a class="headerlink" href="#create-a-test-clusterdeployment" title="Permanent link">#</a></h3>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k0rdent.mirantis.com/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterDeployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test-cluster</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws-standalone-cp-0-0-4</span>
<span class="w">  </span><span class="nt">credential</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws-cred</span>
<span class="w">  </span><span class="nt">serviceSpec</span><span class="p">:</span>
<span class="w">    </span><span class="nt">provider</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ksm-flux</span>
<span class="w">      </span><span class="nt">config</span><span class="p">:</span>
<span class="w">        </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;5m&quot;</span>
<span class="w">        </span><span class="nt">prune</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">        </span><span class="nt">wait</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">        </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;5m&quot;</span>
<span class="w">    </span><span class="nt">services</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">template</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx-4-11-3</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
<span class="w">      </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
</code></pre></div>
<h3 id="verify-the-provider-is-working">Verify the provider is working<a class="headerlink" href="#verify-the-provider-is-working" title="Permanent link">#</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Check StateManagementProvider status</span>
kubectl<span class="w"> </span>get<span class="w"> </span>statemanagementprovider<span class="w"> </span>ksm-flux<span class="w"> </span>-o<span class="w"> </span>yaml

<span class="c1"># Check ServiceSet was created</span>
kubectl<span class="w"> </span>get<span class="w"> </span>serviceset<span class="w"> </span>-A

<span class="c1"># Check Flux resources were created</span>
kubectl<span class="w"> </span>get<span class="w"> </span>helmrelease<span class="w"> </span>-A
kubectl<span class="w"> </span>get<span class="w"> </span>kustomization<span class="w"> </span>-A

<span class="c1"># Check service status</span>
kubectl<span class="w"> </span>get<span class="w"> </span>clusterdeployment<span class="w"> </span>test-cluster<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.status.services}&#39;</span>
</code></pre></div>
<h2 id="best-practices">Best Practices<a class="headerlink" href="#best-practices" title="Permanent link">#</a></h2>
<h3 id="1-error-handling">1. Error Handling<a class="headerlink" href="#1-error-handling" title="Permanent link">#</a></h3>
<p>Always provide clear error messages in service states:</p>
<div class="highlight"><pre><span></span><code><span class="nx">state</span><span class="p">.</span><span class="nx">State</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">kcmv1</span><span class="p">.</span><span class="nx">ServiceStateFailed</span>
<span class="nx">state</span><span class="p">.</span><span class="nx">FailureMessage</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;HelmRelease failed: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">condition</span><span class="p">.</span><span class="nx">Message</span><span class="p">)</span>
</code></pre></div>
<h3 id="2-status-updates">2. Status Updates<a class="headerlink" href="#2-status-updates" title="Permanent link">#</a></h3>
<p>Update ServiceSet status frequently to give users visibility:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Update service state immediately when detected</span>
<span class="k">if</span><span class="w"> </span><span class="nx">oldState</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">newState</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">state</span><span class="p">.</span><span class="nx">LastStateTransitionTime</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">metav1</span><span class="p">.</span><span class="nx">Time</span><span class="p">{</span><span class="nx">Time</span><span class="p">:</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">()}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="3-label-management">3. Label Management<a class="headerlink" href="#3-label-management" title="Permanent link">#</a></h3>
<p>Use consistent labels for tracking resources:</p>
<div class="highlight"><pre><span></span><code><span class="nx">labels</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;ksm.k0rdent.mirantis.com/managed&quot;</span><span class="p">:</span><span class="w">    </span><span class="s">&quot;true&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;ksm.k0rdent.mirantis.com/serviceset&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">serviceSet</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;ksm.k0rdent.mirantis.com/service&quot;</span><span class="p">:</span><span class="w">    </span><span class="nx">svc</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="4-owner-references">4. Owner References<a class="headerlink" href="#4-owner-references" title="Permanent link">#</a></h3>
<p>Set owner references for automatic cleanup:</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">controllerutil</span><span class="p">.</span><span class="nx">SetControllerReference</span><span class="p">(</span><span class="nx">serviceSet</span><span class="p">,</span><span class="w"> </span><span class="nx">resource</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Scheme</span><span class="p">());</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="5-configuration-validation">5. Configuration Validation<a class="headerlink" href="#5-configuration-validation" title="Permanent link">#</a></h3>
<p>Validate provider configuration early:</p>
<div class="highlight"><pre><span></span><code><span class="nx">config</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">FluxProviderConfig</span><span class="p">{}</span>
<span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">Unmarshal</span><span class="p">(</span><span class="nx">serviceSet</span><span class="p">.</span><span class="nx">Spec</span><span class="p">.</span><span class="nx">Provider</span><span class="p">.</span><span class="nx">Config</span><span class="p">.</span><span class="nx">Raw</span><span class="p">,</span><span class="w"> </span><span class="nx">config</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;invalid provider config: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">if</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">Interval</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">ParseDuration</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">Interval</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;invalid interval: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="advanced-topics">Advanced Topics<a class="headerlink" href="#advanced-topics" title="Permanent link">#</a></h2>
<h3 id="handling-multiple-clusters">Handling Multiple Clusters<a class="headerlink" href="#handling-multiple-clusters" title="Permanent link">#</a></h3>
<p>If your CD tool doesn't natively support multi-cluster, you can:</p>
<ol>
<li>Use remote kubeconfig secrets</li>
<li>Create CD resources per target cluster</li>
<li>Implement cluster discovery logic</li>
</ol>
<h3 id="priority-and-conflict-resolution">Priority and Conflict Resolution<a class="headerlink" href="#priority-and-conflict-resolution" title="Permanent link">#</a></h3>
<p>Implement priority handling if needed:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Store priority in labels</span>
<span class="nx">labels</span><span class="p">[</span><span class="s">&quot;ksm.k0rdent.mirantis.com/priority&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">Priority</span><span class="p">)</span>

<span class="c1">// Check for conflicts before creating resources</span>
<span class="nx">existingRelease</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">helmv2</span><span class="p">.</span><span class="nx">HelmRelease</span><span class="p">{}</span>
<span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">existingRelease</span><span class="p">)</span>
<span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">existingPriority</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">getPriority</span><span class="p">(</span><span class="nx">existingRelease</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">existingPriority</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">Priority</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;higher priority resource exists&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="health-checks">Health Checks<a class="headerlink" href="#health-checks" title="Permanent link">#</a></h3>
<p>Implement comprehensive health checks:</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">isHealthy</span><span class="p">(</span><span class="nx">helmRelease</span><span class="w"> </span><span class="o">*</span><span class="nx">helmv2</span><span class="p">.</span><span class="nx">HelmRelease</span><span class="p">)</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">cond</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">helmRelease</span><span class="p">.</span><span class="nx">Status</span><span class="p">.</span><span class="nx">Conditions</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">cond</span><span class="p">.</span><span class="nx">Type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Ready&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">cond</span><span class="p">.</span><span class="nx">Status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">metav1</span><span class="p">.</span><span class="nx">ConditionTrue</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">cond</span><span class="p">.</span><span class="nx">Type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;TestSuccess&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">cond</span><span class="p">.</span><span class="nx">Status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">metav1</span><span class="p">.</span><span class="nx">ConditionTrue</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span>
<span class="p">}</span>
</code></pre></div>
<p>The same pattern can be applied to any CD tool. The key is translating ServiceSet specifications into your CD tool's native resources and reporting status back to K0rdent.</p>









  



  <form class="md-feedback" name="feedback" hidden>
    <fieldset>
      <legend class="md-feedback__title">
        Was this page helpful?
      </legend>
      <div class="md-feedback__inner">
        <div class="md-feedback__list">
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page was helpful" data-md-value="1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12 21.35-1.45-1.32C5.4 15.36 2 12.27 2 8.5 2 5.41 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.08C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.41 22 8.5c0 3.77-3.4 6.86-8.55 11.53z"/></svg>
            </button>
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page could be improved" data-md-value="0">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12 21.35-1.45-1.32C5.4 15.36 2 12.27 2 8.5 2 5.41 4.42 3 7.5 3c.67 0 1.32.12 1.94.33L13 9.35l-4 5zM16.5 3C19.58 3 22 5.41 22 8.5c0 3.77-3.4 6.86-8.55 11.53L12 21.35l-1-7 4.5-5-2.65-5.08C13.87 3.47 15.17 3 16.5 3"/></svg>
            </button>
          
        </div>
        <div class="md-feedback__note">
          
            <div data-md-value="1" hidden>
              
              
                
              
              Thanks for your feedback!
            </div>
          
            <div data-md-value="0" hidden>
              
              
                
              
              Thanks for your feedback! Help us improve this page by using our <a href="https://github.com/k0rdent/docs/issues/new" target="_blank" rel="noopener">feedback form</a>.
            </div>
          
        </div>
      </div>
    </fieldset>
  </form>


                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 The k0rdent authors | Documentation distributed under <a href="https://creativecommons.org/licenses/by/4.0/legalcode.txt">CC-BY-4.0</a>.
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://github.com/k0rdent/kcm" target="_blank" rel="noopener" title="k0rdent on GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
    <a href="https://x.com/k0rdent" target="_blank" rel="noopener" title="k0rdent on X" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8l164.9-188.5L26.8 48h145.6l100.5 132.9zm-24.8 373.8h39.1L151.1 88h-42z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://bsky.app/profile/k0rdent.bsky.social" target="_blank" rel="noopener" title="k0rdent on BlueSky" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M111.8 62.2C170.2 105.9 233 194.7 256 242.4c23-47.6 85.8-136.4 144.2-180.2 42.1-31.6 110.3-56 110.3 21.8 0 15.5-8.9 130.5-14.1 149.2-18.2 64.8-84.4 81.4-143.3 71.3C456 322 482.2 380 425.6 438c-107.4 110.2-154.3-27.6-166.3-62.9-1.7-4.9-2.6-7.8-3.3-7.8s-1.6 3-3.3 7.8c-12 35.3-59 173.1-166.3 62.9-56.5-58-30.4-116 72.5-133.5C100 314.6 33.8 298 15.7 233.1 10.4 214.4 1.5 99.4 1.5 83.9c0-77.8 68.2-53.4 110.3-21.8z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://www.youtube.com/channel/UChXQ6kbvjnAtdZAQpl7Fo4A" target="_blank" rel="noopener" title="k0rdent on YouTube" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305m-317.51 213.508V175.185l142.739 81.205z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://www.linkedin.com/company/k0rdent/" target="_blank" rel="noopener" title="k0rdent on LinkedIn" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["toc.autohide", "search.suggest", "search.highlight", "content.code.copy", "navigation.tracking", "toc.follow", "search.suggest", "search.highlight", "content.action.edit", "content.action.view", "navigation.path", "navigation.indexes"], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "stable", "provider": "mike"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
        <script src="../../../javascripts/feedback.js"></script>
      
        <script src="../../../javascripts/plausible.js"></script>
      
    
  </body>
</html>